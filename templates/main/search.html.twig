{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} - Accueil{% endblock %}



{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/search.css') }}">
{% endblock %}

{% block main %}
    <h1 class="py-4 text-center">Liste des sorties</h1>
    <div id="search">
        {{ form_start(searchForm) }}
        <div class="row">
            <div class="col-6">
                {{ form_row(searchForm.keywords) }}
            </div>
            <div class="col-6">
                {{ form_row(searchForm.campus) }}
            </div>
        </div>
        <div class="row">
            <div class="col-6">
                {{ form_row(searchForm.startDate) }}
            </div>
            <div class="col-6">
                {{ form_row(searchForm.endDate) }}
            </div>
        </div>
        <div class="row">
            <div class="col-6">
                {{ form_row(searchForm.isOrganiser) }}
            </div>
            <div class="col-6">
                {{ form_row(searchForm.isSignedUp) }}
            </div>
        </div>
        <div class="row">
            <div class="col-6">
                {{ form_row(searchForm.isPassedEvent) }}
            </div>
            <div class="col-6">
                {{ form_row(searchForm.isNotSignedUp) }}
            </div>
        </div>

        {{ form_end(searchForm) }}
    </div>
    <div id="events">
        <h4>{{ events | length }} sorties trouvées</h4>
        <div class="row">
            <div class="col-2">Nom de la sortie</div>
            <div class="col-2">Date de la sortie</div>
            <div class="col-1">Clôture</div>
            <div class="col-1">Inscrits / places</div>
            <div class="col-1">Etat</div>
            <div class="col-1">Inscrit</div>
            <div class="col-2">Organisateur</div>
            <div class="col-2">Actions</div>
        </div>
        {% for event in events %}
            <div class="row {{ cycle(['odd', 'even'], loop.index0) }} py-2">
                <div class="col-2">{{ event.id }} {{ event.name }}</div>
                <div class="col-2">{{ event.startDateTime | date('d/m/y H:i') }}</div>
                <div class="col-1">{{ event.inscriptionLimit | date('d/m/y') }}</div>
                <div class="col-1">{{ event.participants | length }}/{{ event.maxParticipant }}</div>
                <div class="col-1">{{ event.state.name }}</div>
                <div class="col-1">
                    {% if app.user in event.participants %}
                        <svg class="">
                            <use xlink:href="{{ asset('img/icons/bootstrap-icons.svg#person-check') }}"/>
                        </svg>
                        {#
                        <img src="{{ asset('img/green-check-mark.png') }}" alt="inscrits">
                        #}
                    {% endif %}
                </div>
                <div class="col-2">{{ event.organiser.username }}</div>
                <div class="col-2">
                    {% if event.state.name == constant('OPENED', event.state)
                        or event.state.name == constant('CLOSED', event.state)
                        or event.state.name == constant('CANCELED', event.state)
                        or event.state.name == constant('ONGOING', event.state)
                        or event.state.name == constant('PASSED', event.state) %}
                        <a href="{{ path('event_show', { 'id': event.id }) }}" title="Afficher">
                            <svg class="">
                                <use xlink:href="{{ asset('img/icons/bootstrap-icons.svg#eye') }}"/>
                            </svg>
                            {#
                            Afficher
                            #}
                        </a>
                    {% endif %}

                    {% if app.user == event.organiser and event.state.name == constant('CREATED', event.state) %}
                        <a href="{{ path('event_modify', { 'id': event.id }) }}">
                            <svg class="">
                                <use xlink:href="{{ asset('img/icons/bootstrap-icons.svg#pencil-square') }}"/>
                            </svg>
                            {#
                            Modifier

                            #}
                        </a>
                    {% endif %}
                    {% if app.user == event.organiser and event.state.name == constant('CREATED', event.state) %}
                        <a href="{{ path('event_publish', { 'id': event.id }) }}">
                            <svg class="">
                                <use xlink:href="{{ asset('img/icons/bootstrap-icons.svg#check2-square') }}"/>
                            </svg>
                            {#
                            Publier
                            #}
                        </a>
                    {% endif %}
                    {% if app.user == event.organiser and (event.state.name == constant('CLOSED', event.state) or event.state.name == constant('OPENED', event.state)) %}
                        <a href="{{ path('event_cancel', { 'id': event.id}) }}">
                            <svg class="">
                                <use xlink:href="{{ asset('img/icons/bootstrap-icons.svg#trash') }}"/>
                            </svg>
                            {#
                            Annuler
                            #}
                        </a>
                    {% endif %}
                    {% if app.user not in event.participants and event.state.name == constant('OPENED', event.state) %}
                        <a href="{{ path('event_signup', { 'id': event.id}) }}">
                            <svg class="">
                                <use xlink:href="{{ asset('img/icons/bootstrap-icons.svg#box-arrow-in-right') }}"/>
                            </svg>
                            {#
                            S'inscrire
                            #}
                        </a>
                    {% endif %}

                    {% if app.user in event.participants and (event.state.name == constant('OPENED', event.state) or event.state.name == constant('CLOSED', event.state)) %}
                        <a href="{{ path('event_withdraw', { 'id': event.id}) }}">
                            <svg class="">
                                <use xlink:href="{{ asset('img/icons/bootstrap-icons.svg#box-arrow-left') }}"/>
                            </svg>
                            {#
                            Se désinscrire
                            #}
                        </a>
                    {% endif %}


                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}